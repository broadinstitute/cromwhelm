{{- if .Values.cbasUI.enabled }}
{{ include "terra-batch-libchart.cbas-ui-deploy" (list . "coa-helm.cbas-ui-deploy") }}
{{ end }}
{{ define "coa-helm.cbas-ui-deploy" }}
spec:
  template:
    metadata:
      annotations:
        checksum/config: {{ include ("coa-helm.cbas-ui-config") . | sha256sum }}
      labels:
    {{ include "coa-helm.labels" $ | nindent 8 }}
    spec:
      {{- if .Values.workloadIdentity.enabled }}
      serviceAccountName: {{ .Values.workloadIdentity.serviceAccountName }}
      {{ end }}
{{ end }}

---
{{- if .Values.cbasUI.enabled }}
{{ include "terra-batch-libchart.cbas-ui-service" (list . "coa-helm.cbas-ui-service") }}
{{ end }}
{{ define "coa-helm.cbas-ui-service" }}
# Overrides go here
{{ end }}

---
{{- if .Values.cbasUI.enabled }}
{{ include "terra-batch-libchart.cbas-ui-config" (list . "coa-helm.cbas-ui-config") }}
{{ end }}
{{ define "coa-helm.cbas-ui-config" }}
data:
  {{ .Values.cbasUI.conf_file }}: |-
    {
      "leoUrlRoot" : "{{ .Values.leonardo.url }}",
      "cbasUrlRoot" : "{{ .Values.relay.path }}/cbas",
      "cromwellUrlRoot" : "{{ .Values.relay.path }}/cromwell",
      "wdsAppTypeNames": ["WDS", "CROMWELL"],
      "wdsInstanceId" : "{{ .Values.persistence.workspaceManager.workspaceId }}",
      "workspaceManagerRoot" : "{{ .Values.persistence.workspaceManager.url }}",
      "workspaceId" : "{{ .Values.persistence.workspaceManager.workspaceId }}",
      "containerResourceId" : "{{ .Values.persistence.workspaceManager.containerResourceId }}",
      "dockstoreRootUrl": "{{ .Values.dockstore.baseUrl }}"
    }
{{ end }}
